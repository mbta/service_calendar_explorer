(this["webpackJsonpservices-explorer"]=this["webpackJsonpservices-explorer"]||[]).push([[0],{161:function(e,t,a){e.exports=a(279)},174:function(e,t,a){},175:function(e,t,a){},279:function(e,t,a){"use strict";a.r(t);var r=a(1),n=a.n(r),c=a(72),o=a.n(c),l=a(14),s=a(110),i=a(13),u=a(73),d=a(147),m=a.n(d);function p(e){return fetch("".concat("https://green.dev.api.mbtace.com").concat(e),{headers:[["x-api-key","".concat("e9bea64ef3d34cf89e404c7103d55cbd")]]})}function f(e){window.localStorage.setItem("mbta-service-exp--state",JSON.stringify(e))}var E=function(){var e=window.localStorage.getItem("mbta-service-exp--state");return e?JSON.parse(e):null}(),b=E||{routes:["Red","39"],loading:!0,error:null},g=m.a.enhancer({params:{routes:{selector:function(e){return e.routes},action:function(e){return{type:"setPageNumber",payload:e}},defaultValue:b.routes}},initialTruth:"store"}),v=Object(u.b)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:b,t=arguments.length>1?arguments[1]:void 0,a=Object(i.a)({},e),r=t.payload||{},n=r.routes,c=r.route,o=r.error;switch(t.type){case"START_LOAD":a=Object(i.a)(Object(i.a)({},a),{},{loading:!0});break;case"END_LOAD":a=Object(i.a)(Object(i.a)({},a),{},{loading:!1});break;case"SET_ERROR":a=Object(i.a)(Object(i.a)({},a),{},{loading:!1,error:o||e.error});break;case"INCLUDE_ROUTE":a=Object(i.a)(Object(i.a)({},a),{},{routes:c&&a.routes?[].concat(Object(s.a)(a.routes),[c]):e.routes});break;case"EXCLUDE_ROUTE":a=Object(i.a)(Object(i.a)({},a),{},{routes:a.routes?Object(s.a)(a.routes.filter((function(e){return e!==c}))):[]});break;case"SET_ROUTES":a=Object(i.a)(Object(i.a)({},a),{},{routes:n||[]})}return f(a),a}),b,g),h=(a(171),a(174),a(175),a(48)),y=a.n(h),O=a(75),_=a(36),w=function(e){var t=e.route,a=e.checked,c=t.attributes,o=c.color,s=c.text_color,i=c.type,u=c.short_name,d=c.long_name,m={backgroundColor:"#".concat(o),color:"#".concat(s)},p=3===i?u:d,f=Object(l.b)(),E=Object(r.useCallback)((function(){f({type:a?"EXCLUDE_ROUTE":"INCLUDE_ROUTE",payload:{route:t.id}})}),[a]);return n.a.createElement("label",{className:"badge badge-pill btn btn__route",style:m,onClick:E},n.a.createElement("input",{type:"checkbox",name:t.id,id:t.id,checked:a,readOnly:!0}),function(e){var t=e.replace(/(line|trolley|pilot|ferry|event service)/gi,"");return["red","mattapan","orange","blue"].includes(t.toLowerCase().trim())?t.charAt(0):"green"===t.split(" ")[0].toLowerCase()?t.split(" ")[2]:t.trim().substr(0,4)}(p),a&&" \u24e7")};function j(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=Object(r.useState)((function(){return window.localStorage.getItem(e)||t})),n=Object(_.a)(a,2),c=n[0],o=n[1],l=function(t){var a=JSON.stringify(t);o(a),window.localStorage.setItem(e,a)};Object(r.useEffect)((function(){var a=window.localStorage.getItem(e);c!==a&&o(a||t)}),[t,e,c]);var s=Object(r.useCallback)((function(a){a.key===e&&a.newValue!==c&&o(a.newValue||t)}),[t,e,c]);Object(r.useEffect)((function(){return window.addEventListener("storage",s),function(){return window.removeEventListener("storage",s)}}),[s]);var i=c?JSON.parse(c):"";return[i,l]}var k=function(){var e=j("mbta-service-exp--allRoutes"),t=Object(_.a)(e,2),a=t[0],c=t[1],o=Object(l.c)((function(e){return e.routes})),s=Object(l.b)();if(Object(r.useEffect)((function(){a||function(){var e=Object(O.a)(y.a.mark((function e(){var t,a;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,p("/routes");case 3:return t=e.sent,e.next=6,t.json();case 6:a=e.sent,c(a.data),s({type:"SET_ERROR",payload:{error:null}}),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),s({type:"SET_ERROR",payload:{error:e.t0}});case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(){return e.apply(this,arguments)}}()()}),[a]),!a)return null;var i=a.reduce((function(e,t){return o&&o.includes(t.id)?e.selectedRoutes.push(t):e.otherRoutes.push(t),e}),{selectedRoutes:[],otherRoutes:[]});return n.a.createElement(n.a.Fragment,null,n.a.createElement("a",{"data-toggle":"collapse","data-target":"#more-routes","aria-expanded":"false","aria-controls":"more-routes"},"Show/hide more routes"),n.a.createElement("div",{className:"btn-group-toggle btn-group__routes"},i.selectedRoutes.map((function(e){return n.a.createElement(w,{key:e.id,checked:!0,route:e})}))),n.a.createElement("div",{id:"more-routes",className:"collapse btn-group-toggle btn-group__routes"},n.a.createElement("hr",null),i.otherRoutes.map((function(e){return n.a.createElement(w,{key:e.id,checked:!1,route:e})}))))},N=function(e){var t=new Date("".concat(e,"T01:00:00"));return isNaN(t.getTime())?"?":t.toLocaleDateString("en-US",{month:"short",day:"2-digit"})},x=function(e,t){return[e,t].map(N).join("\u2014")},S=function(e){return["\u2753 ","\u2705 ","\u2b50\ufe0f ","\ud83c\udf81 ","\u26a0\ufe0f ","\ud83d\udea8 "][e]},R=function(e){var t=e.id,a=e.service;return n.a.createElement("div",{className:"service border-primary-lightest-contrast"},n.a.createElement("header",{className:"rating"},x(a.rating_start_date,a.rating_end_date),n.a.createElement("span",{className:"float-right"},a.rating_description)),n.a.createElement("div",null,S(a.schedule_typicality),n.a.createElement("span",{className:"badge badge-secondary"},a.schedule_type," [",a.valid_days.join(", "),"]")),n.a.createElement("header",{className:"mt-2"},n.a.createElement("span",{className:"text-uppercase font-weight-bold"},a.schedule_name),n.a.createElement("br",null),x(a.start_date,a.end_date)),a.added_dates.length>0&&n.a.createElement("div",{className:"added-dates"},a.added_dates.map((function(e,t){return n.a.createElement("div",{key:e,className:"text-success"},"\u2295 ",N(e)," ",a.added_dates_notes[t])}))),a.removed_dates.length>0&&n.a.createElement("div",{className:"removed-dates"},a.removed_dates.map((function(e,t){return n.a.createElement("div",{key:e,className:"text-danger"},"\u2296 ",N(e)," ",a.removed_dates_notes[t])}))),n.a.createElement("footer",{className:"text-muted small"},t))};function T(){return(T=Object(O.a)(y.a.mark((function e(t,a,r){var n,c,o;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r({type:"START_LOAD"}),e.prev=1,e.next=4,p("/services?filter%5Broute%5D=".concat(t.sort().join(",")));case 4:return n=e.sent,e.next=7,n.json();case 7:c=e.sent,o=c.data,a(o),r({type:"SET_ERROR",payload:{error:null}}),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(1),r({type:"SET_ERROR",payload:{error:e.t0}});case 16:case"end":return e.stop()}}),e,null,[[1,13]])})))).apply(this,arguments)}var D=function(){var e=Object(l.b)(),t=Object(l.c)((function(e){return e.routes})),a=j(t?t.sort().join("-"):""),c=Object(_.a)(a,2),o=c[0],s=c[1];return Object(r.useEffect)((function(){""===o&&t&&function(e,t,a){T.apply(this,arguments)}(t,s,e)}),[o,t,s,e]),n.a.createElement("div",{className:"services-wrapper"},!!o&&o.map((function(e,t){return n.a.createElement(R,{key:"".concat(e.id,"-").concat(t),id:e.id,service:e.attributes})})))},L=a(310),C=a(306),I=a(311),U=a(312),A=new Date,J=function(e,t){return[e.start_date,e.end_date].map((function(a){var r=a?new Date("".concat(a,"T01:00:00")):new Date("2020-09-30T01:00:00");return{y:t,x:r,service:e}}))},W=function(e,t){return[e.rating_start_date,e.rating_end_date].map((function(a){var r=a?new Date("".concat(a,"T01:00:00")):new Date("2020-09-30T01:00:00");return Object(i.a)(Object(i.a)({},e),{},{y:t,x:r})}))},F=function(e){if("0"===e.index){var t=S(e.datum.schedule_typicality);return n.a.createElement("g",null,n.a.createElement("text",{x:e.x,y:e.y,dy:4,fontSize:10},n.a.createElement("tspan",null,t)))}return null},B=function(){var e=Object(l.c)((function(e){return e.routes})),t=j(e?e.sort().join("-"):"",""),a=Object(_.a)(t,1)[0];return a?n.a.createElement("section",null,n.a.createElement("small",null,"Summary ",n.a.createElement("span",{className:"badge badge-primary ml-2"},a.length," services")),n.a.createElement("div",null,function(e){return n.a.createElement(L.a,{padding:{top:0,left:20,right:20,bottom:30},domain:{y:[-1,e.length]},width:1e3,scale:{x:"time"}},e.map(W).map((function(e,t){return n.a.createElement(C.a,{key:t,style:{data:{stroke:"#e2ecf9",strokeWidth:10}},data:e,labels:function(e){return e.datum.schedule_typicality},labelComponent:n.a.createElement(F,null)})})),e.map(J).map((function(e,t){return n.a.createElement(C.a,{key:t,style:{data:{strokeWidth:3}},data:e})})),n.a.createElement(C.a,{labels:["Today"],labelComponent:n.a.createElement(I.a,{renderInPortal:!0,y:8-e.length,dx:-2,dy:4,textAnchor:"start"}),style:{data:{stroke:"red",strokeWidth:1},labels:{fill:"red",fontSize:8,fontFamily:"Inter"}},data:[{x:A,y:-1},{x:A,y:e.length}]}),n.a.createElement(U.a,{offsetY:30,style:{axis:{strokeWidth:0},ticks:{stroke:"black",strokeOpacity:1},tickLabels:{fontSize:10,padding:2,fontFamily:"Inter"}},tickCount:8,tickFormat:function(e){return e.toLocaleDateString("en-US",{month:"short",day:"2-digit"})}}))}(a.map((function(e){return e.attributes}))))):n.a.createElement("div",{className:"alert alert-warning mb-0 small",role:"alert"},"Make sure at least one route is selected, or try refreshing the page.")},z=function(){return n.a.createElement("div",{className:"spinner-grow text-primary",role:"status"},n.a.createElement("span",{className:"sr-only"},"Loading..."))},M=function(e){var t=e.error;return n.a.createElement("div",{className:"alert alert-danger",role:"alert"},n.a.createElement("h4",{className:"alert-heading"},"Something went wrong"),n.a.createElement("hr",null),n.a.createElement("p",{className:"mb-0"},t))},V=function(){return n.a.createElement("div",{className:"alert alert-warning",role:"alert"},n.a.createElement("h4",{className:"alert-heading"},"No data found"),n.a.createElement("p",null,"Select some routes, maybe?"))};var P=function(){var e=Object(l.c)((function(e){return e.loading})),t=Object(l.c)((function(e){return e.error})),a=Object(l.c)((function(e){return e.routes}));return n.a.createElement("div",{className:"app grid-wrapper"},n.a.createElement("header",null,n.a.createElement("h1",{className:"title"},n.a.createElement("strong",null,"MBTA")," Services Explorer"),n.a.createElement("p",{className:"small"},"Explore way too many services at once.")),n.a.createElement("section",null,n.a.createElement("small",null,"Routes"),n.a.createElement(k,null)),e?n.a.createElement(z,null):t?n.a.createElement(M,{error:t}):a&&a.length?n.a.createElement(n.a.Fragment,null,n.a.createElement(B,null),n.a.createElement("main",null,n.a.createElement("small",null,"Services"),n.a.createElement(D,null))):n.a.createElement(V,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(n.a.createElement(n.a.StrictMode,null,n.a.createElement(l.a,{store:v},n.a.createElement(P,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[161,1,2]]]);
//# sourceMappingURL=main.09bb2604.chunk.js.map