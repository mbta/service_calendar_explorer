(this["webpackJsonpservices-explorer"]=this["webpackJsonpservices-explorer"]||[]).push([[0],{159:function(e,t,a){e.exports=a(276)},171:function(e,t,a){},172:function(e,t,a){},276:function(e,t,a){"use strict";a.r(t);var n=a(1),r=a.n(n),c=a(71),l=a.n(c),o=a(13),s=a(109),i=a(15),u=a(72);function d(e){return fetch("".concat("https://green.dev.api.mbtace.com").concat(e),{headers:[["x-api-key","".concat("e9bea64ef3d34cf89e404c7103d55cbd")]]})}function m(e){window.localStorage.setItem("mbta-service-exp--state",JSON.stringify(e))}var p=function(){var e=window.localStorage.getItem("mbta-service-exp--state");return e?JSON.parse(e):null}(),E=p||{routes:["Red","39"],loading:!0,error:null},f=Object(u.b)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:E,t=arguments.length>1?arguments[1]:void 0,a=Object(i.a)({},e);switch(t.type){case"START_LOAD":a=Object(i.a)(Object(i.a)({},a),{},{loading:!0});break;case"END_LOAD":a=Object(i.a)(Object(i.a)({},a),{},{loading:!1});break;case"SET_ERROR":a=Object(i.a)(Object(i.a)({},a),{},{loading:!1,error:t.payload.error});break;case"INCLUDE_ROUTE":a=Object(i.a)(Object(i.a)({},a),{},{routes:[].concat(Object(s.a)(a.routes),[t.payload.route])});break;case"EXCLUDE_ROUTE":a=Object(i.a)(Object(i.a)({},a),{},{routes:Object(s.a)(a.routes.filter((function(e){return e!==t.payload.route})))})}return m(a),a}),E,window.__REDUX_DEVTOOLS_EXTENSION__&&window.__REDUX_DEVTOOLS_EXTENSION__()),b=(a(168),a(171),a(172),a(47)),g=a.n(b),v=a(74),h=a(35),y=function(e){var t=e.route,a=e.checked,c=t.attributes,l=c.color,s=c.text_color,i=c.type,u=c.short_name,d=c.long_name,m={backgroundColor:"#".concat(l),color:"#".concat(s)},p=3===i?u:d,E=Object(o.b)(),f=Object(n.useCallback)((function(){E({type:a?"EXCLUDE_ROUTE":"INCLUDE_ROUTE",payload:{route:t.id}})}),[a]);return r.a.createElement("label",{className:"badge badge-pill btn btn__route",style:m,onClick:f},r.a.createElement("input",{type:"checkbox",name:t.id,id:t.id,checked:a,readOnly:!0}),function(e){var t=e.replace(/(line|trolley|pilot|ferry|event service)/gi,"");return["red","mattapan","orange","blue"].includes(t.toLowerCase().trim())?t.charAt(0):"green"===t.split(" ")[0].toLowerCase()?t.split(" ")[2]:t.trim().substr(0,4)}(p),a&&" \u24e7")};function O(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=Object(n.useState)((function(){return window.localStorage.getItem(e)||t})),r=Object(h.a)(a,2),c=r[0],l=r[1],o=function(t){var a=JSON.stringify(t);l(a),window.localStorage.setItem(e,a)};Object(n.useEffect)((function(){var a=window.localStorage.getItem(e);c!==a&&l(a||t)}),[t,e,c]);var s=Object(n.useCallback)((function(a){a.key===e&&a.newValue!==c&&l(a.newValue||t)}),[t,e,c]);Object(n.useEffect)((function(){return window.addEventListener("storage",s),function(){return window.removeEventListener("storage",s)}}),[s]);var i=c?JSON.parse(c):"";return[i,o]}var _=function(){var e=O("mbta-service-exp--allRoutes"),t=Object(h.a)(e,2),a=t[0],c=t[1],l=Object(o.c)((function(e){return e.routes})),s=Object(o.b)();if(Object(n.useEffect)((function(){a||function(){var e=Object(v.a)(g.a.mark((function e(){var t,a;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,d("/routes");case 3:return t=e.sent,e.next=6,t.json();case 6:a=e.sent,c(a.data),s({type:"SET_ERROR",payload:{error:null}}),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),s({type:"SET_ERROR",payload:{error:e.t0}});case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(){return e.apply(this,arguments)}}()()}),[a]),!a)return null;var i=a.reduce((function(e,t){return l.includes(t.id)?e.selectedRoutes.push(t):e.otherRoutes.push(t),e}),{selectedRoutes:[],otherRoutes:[]});return r.a.createElement(r.a.Fragment,null,r.a.createElement("a",{"data-toggle":"collapse","data-target":"#more-routes","aria-expanded":"false","aria-controls":"more-routes"},"Show/hide more routes"),r.a.createElement("div",{className:"btn-group-toggle btn-group__routes"},i.selectedRoutes.map((function(e){return r.a.createElement(y,{key:e.id,checked:!0,route:e})}))),r.a.createElement("div",{id:"more-routes",className:"collapse btn-group-toggle btn-group__routes"},r.a.createElement("hr",null),i.otherRoutes.map((function(e){return r.a.createElement(y,{key:e.id,checked:!1,route:e})}))))},w=function(e){var t=new Date("".concat(e,"T01:00:00"));return isNaN(t.getTime())?"?":t.toLocaleDateString("en-US",{month:"short",day:"2-digit"})},j=function(e,t){return[e,t].map(w).join("\u2014")},k=function(e){return["\u2753 ","\u2705 ","\u2b50\ufe0f ","\ud83c\udf81 ","\u26a0\ufe0f ","\ud83d\udea8 "][e]},N=function(e){var t=e.id,a=e.service;return r.a.createElement("div",{className:"service border-primary-lightest-contrast"},r.a.createElement("header",{className:"rating"},j(a.rating_start_date,a.rating_end_date),r.a.createElement("span",{className:"float-right"},a.rating_description)),r.a.createElement("div",null,k(a.schedule_typicality),r.a.createElement("span",{className:"badge badge-secondary"},a.schedule_type," [",a.valid_days.join(", "),"]")),r.a.createElement("header",{className:"mt-2"},r.a.createElement("span",{className:"text-uppercase font-weight-bold"},a.schedule_name),r.a.createElement("br",null),j(a.start_date,a.end_date)),a.added_dates.length>0&&r.a.createElement("div",{className:"added-dates"},a.added_dates.map((function(e,t){return r.a.createElement("div",{key:e,className:"text-success"},"\u2295 ",w(e)," ",a.added_dates_notes[t])}))),a.removed_dates.length>0&&r.a.createElement("div",{className:"removed-dates"},a.removed_dates.map((function(e,t){return r.a.createElement("div",{key:e,className:"text-danger"},"\u2296 ",w(e)," ",a.removed_dates_notes[t])}))),r.a.createElement("footer",{className:"text-muted small"},t))},x=function(){var e=Object(o.b)(),t=Object(o.c)((function(e){return e.routes})),a=O(t.sort().join("-")),c=Object(h.a)(a,2),l=c[0],s=c[1];return Object(n.useEffect)((function(){function a(){return(a=Object(v.a)(g.a.mark((function a(){var n,r,c;return g.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return e({type:"START_LOAD"}),a.prev=1,a.next=4,d("/services?filter%5Broute%5D=".concat(t.sort().join(",")));case 4:return n=a.sent,a.next=7,n.json();case 7:r=a.sent,c=r.data,s(c),e({type:"SET_ERROR",payload:{error:null}}),a.next=16;break;case 13:a.prev=13,a.t0=a.catch(1),e({type:"SET_ERROR",payload:{error:a.t0}});case 16:case"end":return a.stop()}}),a,null,[[1,13]])})))).apply(this,arguments)}""===l&&function(){a.apply(this,arguments)}()}),[l,t,s,e]),r.a.createElement("div",{className:"services-wrapper"},!!l&&l.map((function(e,t){return r.a.createElement(N,{key:"".concat(e.id,"-").concat(t),id:e.id,service:e.attributes})})))},S=a(305),R=a(301),T=a(306),D=a(307),L=new Date,C=function(e,t){return[e.start_date,e.end_date].map((function(a){var n=a?new Date("".concat(a,"T01:00:00")):new Date("2020-09-30T01:00:00");return{y:t,x:n,service:e}}))},I=function(e,t){return[e.rating_start_date,e.rating_end_date].map((function(a){var n=a?new Date("".concat(a,"T01:00:00")):new Date("2020-09-30T01:00:00");return Object(i.a)(Object(i.a)({},e),{},{y:t,x:n})}))},U=function(e){if("0"===e.index){var t=k(e.datum.schedule_typicality);return r.a.createElement("g",null,r.a.createElement("text",{x:e.x,y:e.y,dy:4,fontSize:10},r.a.createElement("tspan",null,t)))}return null},A=function(){var e=O(Object(o.c)((function(e){return e.routes})).sort().join("-"),""),t=Object(h.a)(e,1)[0];return t?r.a.createElement("section",null,r.a.createElement("small",null,"Summary ",r.a.createElement("span",{className:"badge badge-primary ml-2"},t.length," services")),r.a.createElement("div",null,function(e){return r.a.createElement(S.a,{padding:{top:0,left:20,right:20,bottom:30},domain:{y:[-1,e.length]},width:1e3,scale:{x:"time"}},e.map(I).map((function(e,t){return r.a.createElement(R.a,{key:t,style:{data:{stroke:"#e2ecf9",strokeWidth:10}},data:e,labels:function(e){return e.datum.schedule_typicality},labelComponent:r.a.createElement(U,null)})})),e.map(C).map((function(e,t){return r.a.createElement(R.a,{key:t,style:{data:{strokeWidth:3}},data:e})})),r.a.createElement(R.a,{labels:["Today"],labelComponent:r.a.createElement(T.a,{renderInPortal:!0,y:8-e.length,dx:-2,dy:4,textAnchor:"start"}),style:{data:{stroke:"red",strokeWidth:1},labels:{fill:"red",fontSize:8,fontFamily:"Inter"}},data:[{x:L,y:-1},{x:L,y:e.length}]}),r.a.createElement(D.a,{offsetY:30,style:{axis:{strokeWidth:0},ticks:{stroke:"black",strokeOpacity:1},tickLabels:{fontSize:10,padding:2,fontFamily:"Inter"}},tickCount:8,tickFormat:function(e){return e.toLocaleDateString("en-US",{month:"short",day:"2-digit"})}}))}(t.map((function(e){return e.attributes}))))):r.a.createElement("div",{className:"alert alert-warning mb-0 small",role:"alert"},"Make sure at least one route is selected, or try refreshing the page.")},J=function(){return r.a.createElement("div",{className:"spinner-grow text-primary",role:"status"},r.a.createElement("span",{className:"sr-only"},"Loading..."))},W=function(e){var t=e.error;return r.a.createElement("div",{className:"alert alert-danger",role:"alert"},r.a.createElement("h4",{className:"alert-heading"},"Something went wrong"),r.a.createElement("hr",null),r.a.createElement("p",{className:"mb-0"},t))},X=function(){return r.a.createElement("div",{className:"alert alert-warning",role:"alert"},r.a.createElement("h4",{className:"alert-heading"},"No data found"),r.a.createElement("p",null,"Select some routes, maybe?"))};var F=function(){var e=Object(o.c)((function(e){return e.loading})),t=Object(o.c)((function(e){return e.error})),a=Object(o.c)((function(e){return e.routes}));return r.a.createElement("div",{className:"app grid-wrapper"},r.a.createElement("header",null,r.a.createElement("h1",{className:"title"},r.a.createElement("strong",null,"MBTA")," Services Explorer"),r.a.createElement("p",{className:"small"},"Explore way too many services at once.")),r.a.createElement("section",null,r.a.createElement("small",null,"Routes"),r.a.createElement(_,null)),e?r.a.createElement(J,null):t?r.a.createElement(W,{error:t}):a.length?r.a.createElement(r.a.Fragment,null,r.a.createElement(A,null),r.a.createElement("main",null,r.a.createElement("small",null,"Services"),r.a.createElement(x,null))):r.a.createElement(X,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));l.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(o.a,{store:f},r.a.createElement(F,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[159,1,2]]]);
//# sourceMappingURL=main.63db4894.chunk.js.map